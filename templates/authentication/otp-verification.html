{% extends "layouts/base-auth.html" %}
{% load static %}

{% block content %}

    <div class="flex flex-col items-center justify-center px-6 pt-8 mx-auto md:h-screen pt:mt-0 dark:bg-gray-900">
        <a href="/" class="flex items-center justify-center mb-8 text-2xl font-semibold lg:mb-10 dark:text-white">
            <img src="{% static "dist/images/grc_picture2.png" %}" class="mr-4 h-11" alt="FlowBite Logo">
            <span>GRC Server</span>  
        </a>
        <!-- Card -->
        <div class="w-full max-w-xl p-6 space-y-8 sm:p-8 bg-white rounded-lg shadow dark:bg-gray-800">
            <h2 class="text-2xl font-bold text-gray-900 dark:text-white">
                Sign IN to platform 
            </h2>

            {% if messages %}
                {% for message in messages %}
                    <div class="flex items-center p-4 mb-4 text-sm text-red-800 border border-red-300 rounded-lg bg-red-50 dark:bg-gray-800 dark:text-red-400 dark:border-red-800" role="alert">
                        <svg class="flex-shrink-0 inline w-4 h-4 mr-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 20 20">
                        <path d="M10 .5a9.5 9.5 0 1 0 9.5 9.5A9.51 9.51 0 0 0 10 .5ZM9.5 4a1.5 1.5 0 1 1 0 3 1.5 1.5 0 0 1 0-3ZM12 15H8a1 1 0 0 1 0-2h1v-3H8a1 1 0 0 1 0-2h2a1 1 0 0 1 1 1v4h1a1 1 0 0 1 0 2Z"/>
                        </svg>
                        <span class="sr-only">Info</span>
                        <div>
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}

            <hr>

            <form class="mt-8 space-y-6" method="post">
                {% csrf_token %}
                {% for field in form %}
                    <div>
                        <label for="{{ field.name }}" class="block mb-2 text-sm font-medium text-gray-900 dark:text-white">{{ field.label }}</label>
                        {{ field }}
                        <span class="block dark:text-red-800 mt-2 text-sm">{{ field.errors }}</span>
                    </div>
                {% endfor %}
                <div class="flex items-start">
                    <a href="{% url "resend_otp" %}" id="resend-otp-link" class="ml-auto text-sm text-primary-700 hover:underline dark:text-primary-500">Resend OTP</a>
                    <span id="resend-timer" class="hidden ml-auto text-sm text-primary-700 dark:text-primary-500"></span>
                </div>
                <button type="submit" class="w-full px-5 py-3 text-base font-medium text-center text-white bg-primary-700 rounded-lg hover:bg-primary-800 focus:ring-4 focus:ring-primary-300 sm:w-auto dark:bg-primary-600 dark:hover:bg-primary-700 dark:focus:ring-primary-800">Verify</button>
            </form>
        </div>
    </div>


{% endblock content %}

{% block extra_js %}

<script>
    document.addEventListener('DOMContentLoaded', function() {
        var resendLink = document.getElementById('resend-otp-link');
        var timerSpan = document.getElementById('resend-timer');
        var resendCooldown = 60;

        function startCountdown(seconds) {
            var remaining = seconds;
            resendLink.style.display = 'none';
            timerSpan.style.display = 'inline';

            var interval = setInterval(function() {
                if (remaining <= 0) {
                    clearInterval(interval);
                    timerSpan.style.display = 'none';
                    resendLink.style.display = 'inline';
                } else {
                    timerSpan.textContent = `Resend OTP in ${remaining} seconds`;
                    remaining--;
                }
            }, 1000);
        }

        var lastOtpSent = localStorage.getItem('lastOtpSent');
        var currentTime = Math.floor(Date.now() / 1000);

        if (lastOtpSent && (currentTime - lastOtpSent < resendCooldown)) {
            startCountdown(resendCooldown - (currentTime - lastOtpSent));
        } else {
            resendLink.style.display = 'inline';
        }

        resendLink.addEventListener('click', function() {
            localStorage.setItem('lastOtpSent', Math.floor(Date.now() / 1000));
        });
    });
  </script>

{% endblock extra_js %}