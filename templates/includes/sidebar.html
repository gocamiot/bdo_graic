{% load static i18n get_attribute replace_value %}
{% get_current_language as LANGUAGE_CODE %}
{% get_available_languages as LANGUAGES %}
{% get_language_info_list for LANGUAGES as languages %}


<style>
    #sidebar.collapsed {
        width: 65px;
    }     
    #main-content.main-content-expanded {
        margin-left: 64px;
        width: calc(100% - 64px);
    } 
  
    #sidebar ::-webkit-scrollbar {
        width: 3px !important;
    }

    #sidebar ::-webkit-scrollbar-track {
        background: #f1f1f1 !important;
    }

    #sidebar ::-webkit-scrollbar-thumb {
        background: #888 !important;
    }

    #sidebar ::-webkit-scrollbar-thumb:hover {
        background: #555 !important;
    }
  </style>

<aside id="sidebar"
    class="fixed top-0 left-0 z-20 flex flex-col flex-shrink-0 hidden w-64 h-full pt-16 font-normal duration-75 lg:flex transition-width"
    aria-label="Sidebar">
    <div
        class="relative flex flex-col flex-1 min-h-0 pt-0 bg-white border-r border-gray-200 dark:bg-gray-800 dark:border-gray-700">
        <div class="flex flex-col flex-1 pt-5 pb-4 overflow-y-auto">
            <div class="flex-1 px-3 space-y-1 bg-white divide-y divide-gray-200 dark:bg-gray-800 dark:divide-gray-700">
                {% if '/graic/chat/' in request.path %}
                    {% include "includes/sidebar-graic.html" %}
                {% else %}
                    {% include "includes/sidebar-dt.html" %}
                {% endif %}
            </div>
        </div>
    </div>
</aside>

{% for parent_qs, children in sidebar_dict.items %}

    {% if not children %}
        <div id="{{ parent_qs.name }}-{{ parent_qs.id }}" data-modal-placement="top-left" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative p-4 w-full max-w-md max-h-full">
                <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                    <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                        <h3 class="text-xl font-medium text-gray-900 dark:text-white">
                            {{ parent_qs.name }}
                        </h3>
                        <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="{{ parent_qs.name }}-{{ parent_qs.id }}">
                            <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                            </svg>
                            <span class="sr-only">Close modal</span>
                        </button>
                    </div>
                    <div class="p-4 md:p-5 space-y-4">
                        <p class="text-base leading-relaxed text-gray-500 dark:text-gray-400">
                            {{ parent_qs.info }}
                        </p>
                    </div>
                </div>
            </div>
        </div>

    {% else %}
        {% for child in children %}
        <div id="{{ child.name }}-{{ child.id }}" data-modal-placement="top-left" tabindex="-1" class="fixed top-0 left-0 right-0 z-50 hidden w-full p-4 overflow-x-hidden overflow-y-auto md:inset-0 h-[calc(100%-1rem)] max-h-full">
            <div class="relative p-4 w-full max-w-md max-h-full">
                <div class="relative bg-white rounded-lg shadow dark:bg-gray-700">
                    <div class="flex items-center justify-between p-4 md:p-5 border-b rounded-t dark:border-gray-600">
                        <h3 class="text-xl font-medium text-gray-900 dark:text-white">
                            {{ child.name }}
                        </h3>
                        <button type="button" class="text-gray-400 bg-transparent hover:bg-gray-200 hover:text-gray-900 rounded-lg text-sm w-8 h-8 ms-auto inline-flex justify-center items-center dark:hover:bg-gray-600 dark:hover:text-white" data-modal-hide="{{ child.name }}-{{ child.id }}">
                            <svg class="w-3 h-3" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 14">
                                <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="m1 1 6 6m0 0 6 6M7 7l6-6M7 7l-6 6"/>
                            </svg>
                            <span class="sr-only">Close modal</span>
                        </button>
                    </div>
                    <div class="p-4 md:p-5 space-y-4">
                        <p class="text-base leading-relaxed text-gray-500 dark:text-gray-400">
                            {{ child.info }}
                        </p>
                    </div>
                </div>
            </div>
        </div>
        {% endfor %}

    {% endif %}

{% endfor %}

{% include "includes/modals.html" %}


<script>
    document.getElementById('sidebar-collapse').addEventListener('click', function() {
        document.getElementById('sidebar').classList.toggle('collapsed');
        document.getElementById('main-content').classList.toggle('main-content-expanded');
  
        const collapsedIcons = document.querySelectorAll('.collapsed-icon');
        const fullSidebarItems = document.querySelectorAll('.sidebar-full');
        collapsedIcons.forEach(icon => icon.classList.toggle('hidden'));
        fullSidebarItems.forEach(item => item.classList.toggle('hidden'));
    });      
</script>
